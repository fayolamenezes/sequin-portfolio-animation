<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Vertical Infinite Carousel</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      background: #f0f0f0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      overflow: hidden;
    }

    .carousel-wrapper {
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .carousel {
      width: 290px;
      height: 100vh;
      overflow: hidden;
      position: relative;
    }

    .carousel-inner {
      display: flex;
      flex-direction: column;
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
    }

    .card {
      width: 280px;
      height: 450px;
      flex-shrink: 0;
      margin: 5px auto;
    }

    /* Color samples */
    .c1 { background: #5a1010; }
    .c2 { background: #0b2b40; }
    .c3 { background: #6a5a0e; }
    .c4 { background: #062b10; }
    .c5 { background: #24084a; }
  </style>
</head>
<body>

  <div class="carousel-wrapper">
    <div class="carousel" id="carousel1">
      <div class="carousel-inner"></div>
    </div>

    <div class="carousel" id="carousel2">
      <div class="carousel-inner"></div>
    </div>
  </div>

<script>
  const cardClasses = ['c1', 'c2', 'c3', 'c4', 'c5'];
  let anim1, anim2;

  function createCards(container, reversed = false) {
    const inner = container.querySelector('.carousel-inner');
    const classes = reversed ? [...cardClasses].reverse() : cardClasses;
    classes.forEach(cls => {
      const card = document.createElement('div');
      card.className = `card ${cls}`;
      inner.appendChild(card);
    });
    classes.forEach(cls => {
      const card = document.createElement('div');
      card.className = `card ${cls}`;
      inner.appendChild(card);
    });
  }

  createCards(document.getElementById('carousel1'), false);
  createCards(document.getElementById('carousel2'), true);

  const cardHeight = 591;

  function startVerticalLoop(selector, duration = 15, direction = 'up') {
    const el = document.querySelector(selector + ' .carousel-inner');
    const cardCount = el.children.length / 2;
    gsap.set(el, { y: direction === 'up' ? 0 : -(cardHeight * cardCount) });

    return gsap.to(el, {
      y: direction === 'up' ? -(cardHeight * cardCount) : 0,
      ease: 'none',
      duration,
      repeat: -1,
    });
  }

  function updateDirection(direction) {
    anim1?.kill();
    anim2?.kill();
    anim1 = startVerticalLoop('#carousel1', 25, direction);
    anim2 = startVerticalLoop('#carousel2', 25, direction === 'up' ? 'down' : 'up');
  }

  anim1 = startVerticalLoop('#carousel1', 25, 'up');
  anim2 = startVerticalLoop('#carousel2', 25, 'down');

  // Hover Pause
  const wrapper = document.querySelector('.carousel-wrapper');
  wrapper.addEventListener('mouseenter', () => {
    anim1.pause();
    anim2.pause();
  });
  wrapper.addEventListener('mouseleave', () => {
    anim1.play();
    anim2.play();
  });

  // Drag Logic
  let isDragging = false;
  let startY = 0;
  let currentCarousel, oppositeCarousel;
  let currentY = 0;
  let lastDelta = 0;

  let rafID = null;

  const carousels = document.querySelectorAll('.carousel');
  carousels.forEach(carousel => {
    const inner = carousel.querySelector('.carousel-inner');

    const onDragStart = e => {
      isDragging = true;
      startY = e.touches ? e.touches[0].clientY : e.clientY;
      currentCarousel = inner;
      oppositeCarousel = currentCarousel === document.querySelector('#carousel1 .carousel-inner')
        ? document.querySelector('#carousel2 .carousel-inner')
        : document.querySelector('#carousel1 .carousel-inner');

      anim1.pause();
      anim2.pause();

      cancelAnimationFrame(rafID);
      rafID = requestAnimationFrame(updateDrag);
    };

    const onDragMove = e => {
      if (!isDragging) return;
      currentY = e.touches ? e.touches[0].clientY : e.clientY;
      lastDelta = currentY - startY;
    };

    const updateDrag = () => {
      if (!isDragging) return;
      if (lastDelta !== 0) {
        gsap.set(currentCarousel, { y: `+=${lastDelta}` });
        gsap.set(oppositeCarousel, { y: `-=${lastDelta}` });
        startY = currentY;
        lastDelta = 0;
      }
      rafID = requestAnimationFrame(updateDrag);
    };

    const onDragEnd = () => {
      if (!isDragging) return;
      isDragging = false;
      cancelAnimationFrame(rafID);

      const direction = lastDelta < 0 ? 'up' : 'down';
      updateDirection(direction);
    };

    // Events
    carousel.addEventListener('mousedown', onDragStart);
    carousel.addEventListener('mousemove', onDragMove);
    carousel.addEventListener('mouseup', onDragEnd);
    carousel.addEventListener('mouseleave', onDragEnd);

    carousel.addEventListener('touchstart', onDragStart);
    carousel.addEventListener('touchmove', onDragMove);
    carousel.addEventListener('touchend', onDragEnd);
  });
</script>


</body>
</html>
